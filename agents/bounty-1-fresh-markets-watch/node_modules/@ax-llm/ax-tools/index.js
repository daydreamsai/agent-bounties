import{spawn as d}from"child_process";import m from"readline";var s=class{process;rl;pendingResponses=new Map;constructor(e){this.process=d(e.command,e.args??[],{env:e.env?{...process.env,...e.env}:process.env}),this.rl=m.createInterface({input:this.process.stdout}),this.rl.on("line",r=>{try{let t=JSON.parse(r),p=this.pendingResponses.get(t.id);p&&(p(t),this.pendingResponses.delete(t.id))}catch{console.warn("Non-JSON output from MCP server:",r)}})}async send(e){return new Promise(r=>{this.pendingResponses.set(e.id,t=>{r(t)}),this.process.stdin.write(`${JSON.stringify(e)}
`)})}async sendNotification(e){this.process.stdin.write(`${JSON.stringify(e)}
`)}async connect(){return Promise.resolve()}async terminate(){return this.rl.close(),this.process.kill(),new Promise(e=>{this.process.on("exit",()=>e())})}};function a(o){return new s(o)}import*as u from"fs";import*as l from"http";import*as C from"https";import*as P from"os";import*as x from"process";import{runInNewContext as f}from"vm";function S(){if(globalThis.crypto&&typeof globalThis.crypto.randomUUID=="function")return globalThis.crypto;throw new Error("Web Crypto API with randomUUID support not available. Requires Node.js 16+ or modern browser.")}var c=(n=>(n.FS="node:fs",n.NET="net",n.OS="os",n.CRYPTO="crypto",n.PROCESS="process",n))(c||{}),i=class{permissions;constructor({permissions:e=[]}={}){this.permissions=e??[]}codeInterpreterJavascript(e){let r={console};return this.permissions.includes("node:fs")&&(r.fs=u),this.permissions.includes("net")&&(r.http=l,r.https=C),this.permissions.includes("os")&&(r.os=P),this.permissions.includes("crypto")&&(r.crypto=S()),this.permissions.includes("process")&&(r.process=x),f(`(function() { ${e} })()`,r)}toFunction(){return{name:"javascriptInterpreter",description:"Use this function to run Javascript code and get any expected return value",parameters:{type:"object",properties:{code:{type:"string",description:"JS code with a return value in the end."}},required:["code"]},func:({code:e})=>this.codeInterpreterJavascript(e)}}};function h(o){return new i(o)}export{i as AxJSInterpreter,c as AxJSInterpreterPermission,s as AxMCPStdioTransport,h as axCreateJSInterpreter,a as axCreateMCPStdioTransport};
//# sourceMappingURL=index.js.map